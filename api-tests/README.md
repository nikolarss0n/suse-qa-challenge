# API Tests

## Overview

This repository contains API tests designed to validate the Rancher login. The tests are implemented in Go and integrated with GitHub Actions for continuous integration.

## Prerequisites

Ensure the following tools are installed on your system:

* Go (version 1.21 or higher)
* Docker
* jq (JSON processor)

### Install jq

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install -y jq
```

**macOS (using Homebrew):**
```bash
brew install jq
```

## Setup

### Clone the Repository

```bash
git clone https://github.com/nikolarss0n/suse-qa-challenge.git
cd suse-qa-challenge
```

### Make the Rancher Script Executable

```bash
chmod +x scripts/rancher-local.sh
```

### Start Rancher and Generate API Tokens

```bash
./scripts/rancher-local.sh start
```

This script performs the following actions:
* Starts the Rancher Docker container on https://localhost:8443
* Waits for Rancher to become available
* Generates API tokens and creates the config.yml file in the api-tests/ directory

## Configuration

The config.yml file is automatically generated by the rancher-local.sh script and located at `api-tests/config.yml`. It contains:

```yaml
base_url: "https://localhost:8443"
username: "generated-username"
password: "generated-token"
```

**Note:** This file is excluded from version control to protect sensitive information.

## Running Tests

Navigate to the api-tests directory and execute the tests using Go:

```bash
cd api-tests
ginkgo -r
```

## GitHub Actions CI/CD

The repository is configured with a GitHub Actions workflow located at `.github/workflows/e2e-tests.yml`. This workflow allows you to run:

* API Tests Only
* UI Tests Only
* Both API and UI Tests

### Triggering the Workflow

**Manual Trigger:**
1. Go to the Actions tab in your GitHub repository
2. Select the Rancher Test Suite workflow
3. Click Run workflow
4. Choose the desired test suite from the dropdown (all, ui, api) and initiate the workflow

**Automatic Triggers:**
* Push Events: On main, test/**, and feature/** branches
* Pull Requests: Targeting the main branch

### Workflow Steps

1. Start Rancher: Launches the Rancher Docker container and generates API tokens
2. Run Tests: Executes API and/or UI tests based on the selected option
3. Upload Artifacts: Collects test reports and screenshots
4. Cleanup: Stops and removes the Rancher Docker container

## Cleanup

To stop and remove the Rancher container manually, run:

```bash
./scripts/rancher-local.sh stop
```

This command ensures that the Rancher environment is properly shut down and cleaned up.
